{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: calc({{ section.settings.section_padding_top }}px * 0.75);
    padding-bottom: calc({{ section.settings.section_padding_bottom }}px  * 0.75);
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.section_padding_top }}px;
      padding-bottom: {{ section.settings.section_padding_bottom }}px;
    }
  }
  {% if section.settings.show_separator_line %}
    .scrolling-text-bar {
        border-bottom: 0.1rem solid rgba(var(--color-foreground), 0.08);
    }
  {% endif %}
{%- endstyle -%}
<style>
  .announcement_area {
      position: relative;
      display: flex;
      justify-content: center;
      flex-wrap: nowrap;
      align-items: center;
      white-space: nowrap;
  }
  .scrolling-text-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
  }
  button.close__announcement--bar {
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
    z-index: 9;
  }
  button.close__announcement--bar.modal__close-button.link {
    width: 60px;
    height: 42px;
  }
  .announcement__image {
    line-height: 1;
  }
  #shopify-section-announcement-bar {
    z-index: 4;
  }
  .announcement__icon--arrow{
    width: 3.5rem;
  }
  .button__icon--arrow_svg{
    max-width: 2.5rem;
  }
  .scrolling-text-bar {
    color: rgb(var(--color-foreground));
  }
  .announcement-bar__message {
    text-align: center;
    padding: 0 10px;
    margin: 0;
  }
  @media only screen and (min-width: 750px){
    .announcement-bar__message {
      padding: 0 30px;
    }
  }
</style>
<script src="{{ 'scrolling-bar.js' | asset_url }}" defer="defer"></script>

{%- if section.settings.announcement_enable -%}
  {{ 'scrolling-bar.css' | asset_url | stylesheet_tag }}
  <div
    class="scrolling__wrapper"
    data-section-id="{{ section.id }}"
    data-section-type="scrolling_bar"
  >
    {%- liquid
      assign page = false
      unless request.page_type == 'index'
        assign page = section.settings.index
      endunless
      if request.page_type == 'index'
        assign page = section.settings.no_index
      endif
    -%}
    {%- unless page == true -%}
      <div
        class="section-{{ section.id }}-padding position-relative d-sm-block scrolling-text-bar color-{{ section.settings.color_scheme }} gradient"
        role="region"
        aria-label="{{ 'sections.header.announcement' | t }}"
        {{ section.shopify_attributes }}
      >
        <marquee-scroll-bar
          class="announcement_area {% if section.settings.marquee_text %} marqueee {% endif %}"
          style="--speed: {{ section.settings.scroll_speed }}s; --scroll-direction: {{ section.settings.scroll_direction }}"
        >
          <div class="scrolling--item">
            {%- for block in section.blocks -%}
              {%- case block.type -%}
                {%- when 'scrolling-bar' -%}
                  <div class="announcement_content">
                    {%- if block.settings.text != blank -%}
                      {%- if block.settings.link != blank -%}
                        <a
                          href="{{ block.settings.link }}"
                          class="announcement-bar__link link--text focus-inset"
                        >
                      {%- endif -%}
                      <p class="announcement-bar__message {{ section.settings.heading_size }}">
                        <span class="announcement__text_inner {% if block.settings.text_stroke %} announcement__text_stroke {% endif %} text">
                          {{ block.settings.text | escape }}
                        </span>
                      </p>

                      <span class="announcement__text_inner text">
                        {% if section.settings.separetor_image != blank %}
                          {%- assign img_alt = section.settings.separetor_image.alt | escape -%}
                          {%- assign img_height = 30 | divided_by: section.settings.separetor_image.aspect_ratio %}
                          {% capture widths %} {{ "30" }}, {{ "30" | times: 1.5 | round }}, {{ "30" | times: 2 }}{% endcapture %}
                          {% capture sizes %}(max-width: {{ 30 | times: 2 }}px) 50vw, {{ 30 }}px{% endcapture %}
                          {{
                            section.settings.separetor_image
                            | image_url: width: 100
                            | image_tag:
                              class: 'scrolling__image',
                              alt: img_alt,
                              widths: widths,
                              sizes: sizes,
                              height: img_height,
                              width: '30'
                          }}
                        {% else %}
                          <svg
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path d="M0.578646 11.3988L3.98615 10.4251C5.52063 9.99244 6.91842 9.17327 8.04577 8.04593C9.17311 6.91858 9.99228 5.52079 10.4249 3.9863L11.3986 0.578803C11.4476 0.459586 11.5309 0.357618 11.638 0.285857C11.745 0.214096 11.871 0.175781 11.9999 0.175781C12.1288 0.175781 12.2548 0.214096 12.3618 0.285857C12.4689 0.357618 12.5522 0.459586 12.6011 0.578803L13.5749 3.9863C14.0075 5.52079 14.8267 6.91858 15.954 8.04593C17.0814 9.17327 18.4792 9.99244 20.0136 10.4251L23.4211 11.3988C23.552 11.4359 23.6671 11.5147 23.7491 11.6232C23.8311 11.7318 23.8755 11.864 23.8755 12.0001C23.8755 12.1361 23.8311 12.2684 23.7491 12.3769C23.6671 12.4854 23.552 12.5642 23.4211 12.6013L20.0136 13.5751C18.4792 14.0077 17.0814 14.8268 15.954 15.9542C14.8267 17.0815 14.0075 18.4793 13.5749 20.0138L12.6011 23.4213C12.564 23.5521 12.4852 23.6673 12.3767 23.7493C12.2682 23.8313 12.1359 23.8756 11.9999 23.8756C11.8639 23.8756 11.7316 23.8313 11.6231 23.7493C11.5146 23.6673 11.4358 23.5521 11.3986 23.4213L10.4249 20.0138C9.99228 18.4793 9.17311 17.0815 8.04577 15.9542C6.91842 14.8268 5.52063 14.0077 3.98615 13.5751L0.578646 12.6013C0.447809 12.5642 0.332657 12.4854 0.25066 12.3769C0.168665 12.2684 0.124302 12.1361 0.124302 12.0001C0.124302 11.864 0.168665 11.7318 0.25066 11.6232C0.332657 11.5147 0.447809 11.4359 0.578646 11.3988Z" fill="currentColor"/>
                          </svg>
                        {% endif %}
                      </span>
                      {%- if block.settings.link != blank -%}
                        </a>
                      {%- endif -%}
                    {%- endif -%}
                  </div>
              {%- endcase -%}
            {%- endfor -%}
          </div>
        </marquee-scroll-bar>
      </div>
    {%- endunless -%}
  </div>
{%- endif -%}

{% schema %}
{
  "name": "t:sections.scrolling-bar.name",
  "settings": [
    {
      "type": "checkbox",
      "id": "announcement_enable",
      "label": "Show announcement",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "index",
      "label": "Show on home page only",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "no_index",
      "label": "Hide on home page only",
      "default": false
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "accent-1"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
          {
            "value": "h2",
            "label": "Large"
          },
          {
            "value": "h3",
            "label": "Medium"
          },
          {
            "value": "h4",
            "label": "Small"
          },
          {
            "value": "h5",
            "label": "Extra Small"
          }
       ],
       "default": "h4",
        "label": "Heading size"
    },
    {
      "type": "image_picker",
      "id": "separetor_image",
      "label": "Image"
    },
    {
      "type": "range",
      "id": "scroll_speed",
      "min": 2,
      "max": 100,
      "step": 2,
      "unit": "s",
      "label": "Speed",
      "default": 10
    },
    {
      "type": "select",
      "id": "scroll_direction",
      "label": "Direction",
      "options": [
        {
          "value": "scrolling-right",
          "label": "Right"
        },
        {
          "value": "scrolling-left",
          "label": "Left"
        }
      ],
      "default": "scrolling-left"
    },
    {
      "type": "checkbox",
      "id": "show_separator_line",
      "label": "Show separator line",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "marquee_text",
      "label": "Active Slide Text",
      "default": true
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "t:sections.all.section-padding-top.label",
      "default": 20
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "t:sections.all.section-padding-bottom.label",
      "default": 20
    }
  ],
  "blocks": [
    {
      "type": "scrolling-bar",
      "name": "t:sections.scrolling-bar.blocks.scrolling-item.name",
      "settings": [
        {
          "type": "textarea",
          "id": "text",
          "default": "Welcome to our store",
          "label": "t:sections.scrolling-bar.blocks.scrolling-item.settings.text.label"
        },
        {
          "type": "url",
          "id": "link",
          "label": "t:sections.scrolling-bar.blocks.scrolling-item.settings.link.label"
        },
        {
          "type": "checkbox",
          "id": "text_stroke",
          "label": "Text stroke",
          "default": false
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.scrolling-bar.name",
      "blocks": [
        {
          "type": "scrolling-bar"
        },
        {
          "type": "scrolling-bar"
        },
        {
          "type": "scrolling-bar"
        },
        {
          "type": "scrolling-bar"
        },
        {
          "type": "scrolling-bar"
        }
      ]
    }
  ]
}
{% endschema %}
